
  CREATE OR REPLACE PACKAGE BODY bloomers_validation_pkg IS
  PROCEDURE bloomers_validation_proc(ERRBUF OUT VARCHAR2,RETCODE OUT NUMBER) IS
     CURSOR C1 IS SELECT author_ID,BOOK_NAME,ISBN_No,PAGES,
                     COST,PUB_DATE,BOOK_TYPE FROM BOOK_TABLE ;
     V_AUTHOR_ID BOOK_TABLE.AUTHOR_ID%TYPE;
     V_BOOK_NAME BOOK_TABLE.BOOK_NAME%TYPE;
     V_ISBN_NO BOOK_TABLE.ISBN_NO%TYPE;
     V_PAGES BOOK_TABLE.PAGES%TYPE;
     V_COST BOOK_TABLE.COST%TYPE;
     V_PUB_DATE BOOK_TABLE.PUB_DATE%TYPE;
     V_BOOK_TYPE BOOK_TABLE.BOOK_TYPE%TYPE;
  BEGIN
     OPEN C1;
     LOOP
     FETCH C1 INTO V_AUTHOR_ID,V_BOOK_NAME,V_ISBN_NO,
             V_PAGES,V_COST,V_PUB_DATE,V_BOOK_TYPE;
     EXIT WHEN C1%NOTFOUND;
     IF(VALIDATE_AUTHOR_ID(V_AUTHOR_ID)) THEN
             IF(VALIDATE_ISBN_NUMBER(V_ISBN_NO)) THEN
                     IF(V_PAGES>0 AND V_COST>0) THEN
                             V_PUB_DATE:=VALIDATE_PUBLISHING_DATE(V_PUB_DATE);
                                     IF(VALIDATE_BOOK_TYPE(V_BOOK_TYPE)) THEN
                                             INSERT INTO BOOKS(BOOK_ID,AUTHOR_ID,BOOK_NAME,ISBN_NO,
                                                     PAGES,COST,PUB_DATE,BOOK_TYPE)
                                                     VALUES (s1.nextval,V_AUTHOR_ID,V_BOOK_NAME,V_ISBN_NO,V_PAGEs,
                                                             V_COST,V_PUB_DATE,V_BOOK_TYPE);
                                     END IF;
                     END IF;
             END IF;
     END IF;
     END LOOP;
     CLOSE C1;
  END bloomers_VALIDATION_proc;
  FUNCTION VALIDATE_AUTHOR_ID(V_AUTHOR_ID NUMBER) RETURN BOOLEAN IS
  CNT NUMBER;
  BEGIN
     SELECT COUNT(*) INTO CNT FROM author_TABLE WHERE ID=V_AUTHOR_ID;
     IF(CNT>0) THEN
             RETURN TRUE;
     ELSE
             RETURN FALSE;
     END IF;
  END VALIDATE_AUTHOR_ID;
  FUNCTION VALIDATE_ISBN_NUMBER(V_ISBN_NUMBER NUMBER) RETURN BOOLEAN IS
  CNT NUMBER;
  BEGIN
     SELECT COUNT(*) INTO CNT FROM book_TABLE WHERE ISBN_NO=V_ISBN_NUMBER;
     IF(CNT=1) THEN
             RETURN TRUE;
     ELSE
             RETURN FALSE;
     END IF;
  END VALIDATE_ISBN_NUMBER;
  FUNCTION VALIDATE_PUBLISHING_DATE(V_PUB_DATE DATE) RETURN DATE IS
  BEGIN
     IF(V_PUB_DATE>SYSDATE) THEN
             RETURN SYSDATE;
     ELSE
             RETURN V_PUB_DATE;
     END IF;
  END VALIDATE_PUBLISHING_DATE;
  FUNCTION VALIDATE_BOOK_TYPE(V_BOOK_TYPE VARCHAR2) RETURN BOOLEAN IS
  BEGIN
     IF(V_BOOK_TYPE = 'Fiction' OR V_BOOK_TYPE = 'Non-Fiction' OR V_BOOK_TYPE = 'Business' OR V_BOOK_TYPE = 'Audio') then
             RETURN TRUE;
     ELSE
             RETURN FALSE;
     END IF;
  END VALIDATE_BOOK_TYPE;
  END bloomers_validation_pkg;